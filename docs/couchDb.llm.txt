# PouchDB & CouchDB Complete Guide for LLMs

## Project Context
This project uses PouchDB (loaded via CDN) for local-first data storage with real-time sync to CouchDB.
- PouchDB is loaded from CDN in index.html to avoid Vite bundling issues
- CouchDB running at: http://127.0.0.1:5984
- Authentication is custom-built using PouchDB directly (no pouchdb-authentication plugin)

---

## 1. INSTALLATION & SETUP

### PouchDB Installation (CDN - Current Approach)
**In index.html:**
```html
<!-- PouchDB from CDN (avoids Vite bundling issues) -->
<script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pouchdb-find@8.0.1/dist/pouchdb.find.min.js"></script>
```

**In TypeScript/JavaScript:**
```typescript
// Declare global PouchDB
declare const PouchDB: any;

// Use it
const db = new PouchDB('my_database');
```

**Why CDN instead of npm?**
- PouchDB's class structure conflicts with Vite's ES module bundling
- CDN version is pre-built and works perfectly in browsers
- Smaller bundle size (not included in app bundle)
- Faster dev server (Vite doesn't process PouchDB)
- Browser caching across projects

### Alternative: npm Installation (Not Used in This Project)
```bash
npm install --save pouchdb
# or for browser-only
npm install --save pouchdb-browser
```

### CouchDB Installation

**Linux (Debian/Ubuntu):**
```bash
sudo apt update && sudo apt install -y curl apt-transport-https gnupg
curl https://couchdb.apache.org/repo/keys.asc | gpg --dearmor | sudo tee /usr/share/keyrings/couchdb-archive-keyring.gpg >/dev/null 2>&1
echo "deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main" | sudo tee /etc/apt/sources.list.d/couchdb.list >/dev/null
sudo apt-get update
sudo apt-get install -y couchdb
```

**Mac/Windows:** Download from official CouchDB website

**Verify Installation:**
```bash
curl localhost:5984
# Expected: {"couchdb":"Welcome","version":"2.2.0",...}
```

**Access Admin Interface:**
Open http://localhost:5984/_utils/ (Fauxton dashboard)

### CORS Configuration (Required for Browser Apps)
```bash
npm install -g add-cors-to-couchdb
add-cors-to-couchdb
```

This enables cross-origin requests for browser-based PouchDB applications.

---

## 2. DATABASE OPERATIONS

### Creating Databases

**Local Database:**
```javascript
const db = new PouchDB('kittens');
// Uses IndexedDB (modern browsers), WebSQL (older), or LevelDB (Node.js)
```

**Remote Database:**
```javascript
const db = new PouchDB('http://localhost:5984/kittens');
// Remote databases are created automatically on first API call
```

### Database Information
```javascript
db.info().then(function (info) {
  console.log(info);
  // Returns: doc_count, db_name, etc.
});
```

### Current Project Setup
```typescript
// src/lib/db.ts
declare const PouchDB: any;

const COUCHDB_URL = "http://127.0.0.1:5984";

// Local databases
export const usersDB = new PouchDB("users");
export const sessionsDB = new PouchDB("sessions");

// Remote databases for sync
export const remoteUsersDB = new PouchDB(`${COUCHDB_URL}/users`);
export const remoteSessionsDB = new PouchDB(`${COUCHDB_URL}/sessions`);
```

---

## 3. DOCUMENT STRUCTURE

### Basic Document Format
```json
{
  "_id": "mittens",
  "_rev": "1-a3b4c5d6e7f8",
  "name": "Mittens",
  "occupation": "kitten",
  "age": 3,
  "hobbies": ["playing", "chasing"]
}
```

### Required Fields

**_id (Primary Key):**
- Must be included when using `put()`
- Used to retrieve documents later
- Can be any string
- Best practice: Use meaningful IDs or timestamps

**_rev (Revision Marker):**
- Automatically generated by PouchDB
- Changes whenever document is created or updated
- Contains randomly-generated ID
- Required for updates and deletes
- Essential for conflict resolution and sync

### SQL to PouchDB Comparison
| SQL          | PouchDB       |
|--------------|---------------|
| Table        | Database      |
| Row          | Document      |
| Column       | Field         |
| Primary Key  | `_id`         |
| Index        | View/Index    |

---

## 4. CREATING & READING DOCUMENTS

### Creating Documents

**Method 1: put() - Requires _id**
```javascript
const doc = {
  _id: 'mittens',
  name: 'Mittens',
  age: 3
};

db.put(doc).then(function (response) {
  console.log(response);
  // { ok: true, id: 'mittens', rev: '1-...' }
}).catch(function (err) {
  console.error(err);
});
```

**Method 2: post() - Auto-generates _id**
```javascript
db.post({
  name: 'Felix',
  age: 2
}).then(function (response) {
  console.log(response.id); // Auto-generated ID
});
```

### Reading Documents

**Get Single Document:**
```javascript
db.get('mittens').then(function (doc) {
  console.log(doc);
}).catch(function (err) {
  if (err.name === 'not_found') {
    console.log('Document not found');
  }
});
```

**Get Multiple Documents:**
```javascript
db.allDocs({
  include_docs: true,
  keys: ['mittens', 'felix', 'garfield']
}).then(function (result) {
  result.rows.forEach(row => console.log(row.doc));
});
```

---

## 5. UPDATING & DELETING DOCUMENTS

### Updating Documents

**IMPORTANT:** Must include entire document with current `_rev`

```javascript
// 1. Get current document
db.get('mittens').then(function (doc) {
  // 2. Modify it
  doc.age = 4;

  // 3. Put it back with _rev
  return db.put(doc);
}).then(function (response) {
  console.log('Updated!', response);
}).catch(function (err) {
  if (err.name === 'conflict') {
    console.log('Conflict! Document was modified by someone else');
  }
});
```

**Creating Default Documents:**
```javascript
db.get('config').catch(function (err) {
  if (err.name === 'not_found') {
    return {
      _id: 'config',
      theme: 'dark',
      notifications: true
    };
  }
  throw err;
}).then(function (configDoc) {
  // Use configDoc (either existing or default)
});
```

### Deleting Documents

Three equivalent methods:

**Method 1: remove(doc)**
```javascript
db.get('mittens').then(function (doc) {
  return db.remove(doc);
});
```

**Method 2: remove(id, rev)**
```javascript
db.remove('mittens', '1-abc123');
```

**Method 3: put with _deleted flag**
```javascript
db.put({
  _id: 'mittens',
  _rev: '1-abc123',
  _deleted: true
});
```

**Important:** Deleted documents aren't erased - they become "tombstones" with `_deleted: true` to preserve revision history for sync.

---

## 6. BULK OPERATIONS

### bulkDocs() - Bulk Writes

**Why Bulk Operations?**
"Bulk operations are faster because they can be combined into a single transaction (IndexedDB/WebSQL) or single HTTP request (CouchDB)."

```javascript
const docs = [
  { _id: 'mittens', name: 'Mittens', age: 3 },
  { _id: 'felix', name: 'Felix', age: 2 },
  { _id: 'garfield', name: 'Garfield', age: 5 }
];

db.bulkDocs(docs).then(function (results) {
  results.forEach(result => {
    if (result.ok) {
      console.log('Saved:', result.id);
    } else {
      console.error('Error:', result);
    }
  });
});
```

**Bulk Update/Delete:**
```javascript
// Include _rev for updates, _deleted for deletes
db.bulkDocs([
  { _id: 'mittens', _rev: '1-abc', age: 4 },
  { _id: 'felix', _rev: '1-def', _deleted: true }
]);
```

### allDocs() - Bulk Reads

**Basic Usage:**
```javascript
db.allDocs({
  include_docs: true
}).then(function (result) {
  result.rows.forEach(row => {
    console.log(row.doc);
  });
});
```

**With Sorting (results auto-sorted by _id):**
```javascript
// Using timestamp IDs for automatic date sorting
const doc = {
  _id: new Date().toJSON(), // "2025-10-22T12:00:00.000Z"
  type: 'event',
  data: 'something happened'
};
```

**Pagination:**
```javascript
db.allDocs({
  include_docs: true,
  limit: 10,
  skip: 20
});
```

**IMPORTANT:** `bulkDocs()` and `allDocs()` do NOT constitute transactions. If one operation fails, others may succeed. Individual documents are the smallest operational unit.

---

## 7. REPLICATION & SYNC

### Core Concept
"CouchDB is bad at everything, except syncing." - PouchDB uses multi-master architecture where any node can be written to or read from.

### Unidirectional Replication

**Local to Remote (Backup):**
```javascript
localDB.replicate.to(remoteDB).on('complete', function () {
  console.log('Replication complete!');
}).on('error', function (err) {
  console.error('Replication error:', err);
});
```

**Remote to Local (Restore):**
```javascript
localDB.replicate.from(remoteDB);
```

### Bidirectional Sync

```javascript
localDB.sync(remoteDB)
  .on('change', function (info) {
    console.log('Change detected:', info);
  })
  .on('complete', function (info) {
    console.log('Sync complete:', info);
  })
  .on('error', function (err) {
    console.error('Sync error:', err);
  });
```

**Equivalent to:**
```javascript
localDB.replicate.to(remoteDB);
localDB.replicate.from(remoteDB);
```

### Live Replication

**Continuous Real-Time Sync:**
```javascript
localDB.sync(remoteDB, {
  live: true,
  retry: true
}).on('change', function (change) {
  console.log('Live change:', change);
}).on('paused', function (info) {
  console.log('Replication paused (offline?)');
}).on('active', function (info) {
  console.log('Replication resumed');
}).on('error', function (err) {
  console.error('Sync error:', err);
});
```

**Options:**
- `live: true` - Keep sync running continuously
- `retry: true` - Auto-reconnect when connection is lost

### Canceling Replication

```javascript
const sync = localDB.sync(remoteDB, { live: true });

// Later...
sync.cancel();
```

### Current Project Setup

```typescript
// src/lib/db.ts
export function setupSync() {
  // Sync users database
  usersDB.sync(remoteUsersDB, {
    live: true,
    retry: true,
  })
  .on("change", (info) => console.log("Users DB sync change:", info))
  .on("error", (err) => console.error("Users DB sync error:", err));

  // Sync sessions database
  sessionsDB.sync(remoteSessionsDB, {
    live: true,
    retry: true,
  })
  .on("change", (info) => console.log("Sessions DB sync change:", info))
  .on("error", (err) => console.error("Sessions DB sync error:", err));
}
```

---

## 8. MANGO QUERIES (find API)

### Overview
"Mango queries (pouchdb-find) allow you to build secondary indexes" for complex filtering operations.

### Installation (Already Done via CDN)
```html
<script src="https://cdn.jsdelivr.net/npm/pouchdb-find@8.0.1/dist/pouchdb.find.min.js"></script>
```

### Two-Step Process

**1. Create Index (expensive, do once):**
```javascript
db.createIndex({
  index: {
    fields: ['name']
  }
}).then(function (result) {
  console.log('Index created');
});
```

**2. Query the Index (fast):**
```javascript
db.find({
  selector: {
    name: 'mario'
  }
}).then(function (result) {
  console.log(result.docs);
});
```

### Query Operators

**Comparison Operators (use on-disk indexes):**
- `$eq`: equals
- `$gt`: greater than
- `$gte`: greater than or equal
- `$lt`: less than
- `$lte`: less than or equal

**Example:**
```javascript
db.find({
  selector: {
    age: { $gte: 21 }
  }
});
```

**Complex Operators (require in-memory filtering - slower):**
- `$regex`: pattern matching
- `$ne`: not equal
- `$not`: logical NOT

### Multi-Field Indexes

**Field order matters!**

```javascript
db.createIndex({
  index: {
    fields: ['name', 'age']
  }
});

// This query uses the index efficiently
db.find({
  selector: {
    name: 'mario',
    age: { $gt: 21 }
  }
});
```

Documents sort by first field, then subsequent fields.

### Sorting

```javascript
db.find({
  selector: {
    name: { $gte: null }
  },
  sort: ['name']
});
```

**Must create index with same sort order:**
```javascript
db.createIndex({
  index: {
    fields: ['name']
  }
});
```

### Pagination

**Efficient pagination using comparison operators:**
```javascript
db.find({
  selector: {
    name: { $gt: 'joy' }
  },
  sort: ['name'],
  limit: 10
});
```

This keeps only necessary documents in memory.

### Query Optimization

**Explain query execution:**
```javascript
db.explain({
  selector: {
    name: 'mario',
    age: { $gt: 21 }
  }
}).then(function (result) {
  console.log(result);
  // Check for warnings about missing indexes
});
```

**Warning signs:**
- "No matching index found, create an index to optimize query time"
- Falls back to expensive in-memory filtering

### Specifying Index

```javascript
db.find({
  selector: { name: 'mario' },
  use_index: 'my-index-design-doc'
});
```

### Current Project Usage

```typescript
// src/lib/db.ts - Initialize indexes
export async function initializeDatabases() {
  // Create indexes for users
  await usersDB.createIndex({
    index: { fields: ["email"] },
  });

  await usersDB.createIndex({
    index: { fields: ["type"] },
  });

  // Create indexes for sessions
  await sessionsDB.createIndex({
    index: { fields: ["userId"] },
  });

  await sessionsDB.createIndex({
    index: { fields: ["expiresAt"] },
  });
}
```

```typescript
// src/lib/auth-service.ts - Using find
const existingUsers = await usersDB.find({
  selector: { email: validated.email, type: "user" },
});

if (existingUsers.docs.length > 0) {
  throw new Error("User already exists");
}
```

---

## 9. ASYNC PATTERNS

### Promise-Based (Recommended)

**Basic Promise:**
```javascript
db.get('mittens')
  .then(function (doc) {
    console.log(doc);
  })
  .catch(function (err) {
    console.error(err);
  });
```

**Promise Chaining:**
```javascript
db.get('mittens')
  .then(function (doc) {
    doc.age = 4;
    return db.put(doc);
  })
  .then(function (response) {
    console.log('Updated!');
  })
  .catch(function (err) {
    console.error('Error at any step:', err);
  });
```

**Why Promises?**
- Avoids "pyramid of doom" with nested callbacks
- Centralized error handling with single `.catch()`
- Better code organization

### Async/Await (Modern - Recommended)

```javascript
async function updateKitten() {
  try {
    const doc = await db.get('mittens');
    doc.age = 4;
    const response = await db.put(doc);
    console.log('Updated!', response);
  } catch (err) {
    console.error('Error:', err);
  }
}
```

**Current Project Uses Async/Await:**
```typescript
// src/lib/auth-service.ts
static async signUp(input: SignUpInput) {
  const validated = v.parse(signUpSchema, input);

  const existingUsers = await usersDB.find({
    selector: { email: validated.email, type: "user" },
  });

  if (existingUsers.docs.length > 0) {
    throw new Error("User already exists");
  }

  const hashedPassword = await hashPassword(validated.password);
  const user = { /* ... */ };

  await usersDB.put(user);

  return { message: "User created successfully" };
}
```

### Callback Style (Legacy - Not Recommended)

```javascript
db.get('mittens', function (err, doc) {
  if (err) {
    console.error(err);
    return;
  }
  console.log(doc);
});
```

---

## 10. REVISION MANAGEMENT & CONFLICTS

### Why Revisions Matter

"Revisions are what makes sync work so well." The revision system:
- Stores document history as a tree (like Git)
- Handles conflicts when databases diverge
- Essential for multi-master replication
- Enables offline-first apps

### Conflict Resolution

When two databases modify the same document offline:

```javascript
db.get('mittens', { conflicts: true })
  .then(function (doc) {
    if (doc._conflicts) {
      console.log('Conflicts detected:', doc._conflicts);

      // Resolve by picking winning revision
      // or merging changes

      // Delete conflicting revisions
      return db.remove(doc._id, doc._conflicts[0]);
    }
  });
```

### Best Practices

1. **Always fetch before update:**
```javascript
const doc = await db.get('mittens');
doc.age = 4;
await db.put(doc); // Includes current _rev
```

2. **Handle 409 conflicts:**
```javascript
try {
  await db.put(doc);
} catch (err) {
  if (err.status === 409) {
    // Conflict! Refetch and retry
    const latestDoc = await db.get(doc._id);
    // Merge changes and try again
  }
}
```

3. **Use upsert for safer updates:**
```javascript
function upsert(docId, diffFunc) {
  return db.get(docId)
    .catch(function (err) {
      if (err.status === 404) {
        return { _id: docId };
      }
      throw err;
    })
    .then(function (doc) {
      const updatedDoc = diffFunc(doc);
      return db.put(updatedDoc);
    })
    .catch(function (err) {
      if (err.status === 409) {
        return upsert(docId, diffFunc); // Retry
      }
      throw err;
    });
}

// Usage
upsert('config', function (doc) {
  doc.theme = 'dark';
  return doc;
});
```

---

## 11. CHANGES FEED

### Listening to Database Changes

```javascript
const changes = db.changes({
  since: 'now',
  live: true,
  include_docs: true
}).on('change', function (change) {
  console.log('Document changed:', change.doc);
}).on('error', function (err) {
  console.error('Changes error:', err);
});

// Cancel later
changes.cancel();
```

### Options

- `since: 'now'` - Only new changes
- `since: 0` - All changes from beginning
- `live: true` - Keep listening for new changes
- `include_docs: true` - Include full document in change event

### Use Cases

- Real-time UI updates
- Activity feeds
- Audit logs
- Triggering side effects

---

## 12. ATTACHMENTS

### Adding Attachments

```javascript
db.put({
  _id: 'mydoc',
  _attachments: {
    'profile.jpg': {
      content_type: 'image/jpeg',
      data: blob // Blob or Buffer
    }
  }
});
```

### Getting Attachments

```javascript
db.getAttachment('mydoc', 'profile.jpg')
  .then(function (blob) {
    const url = URL.createObjectURL(blob);
    document.getElementById('img').src = url;
  });
```

### Attachment Best Practices

- Use for binary data (images, PDFs, etc.)
- Keep attachments reasonable size
- Consider CDN for large files
- Attachments replicate with documents

---

## 13. LOCAL DOCUMENTS

### What Are Local Documents?

Local documents (prefixed with `_local/`) are:
- Not replicated between databases
- Don't create revisions
- Perfect for client-specific settings

### Usage

```javascript
// Save local config
db.put({
  _id: '_local/config',
  theme: 'dark',
  lastSync: Date.now()
});

// Retrieve
db.get('_local/config')
  .then(function (config) {
    console.log('Theme:', config.theme);
  });
```

### Use Cases

- UI preferences
- Sync state tracking
- Client-specific caching
- Session data (local only)

---

## 14. DATABASE MAINTENANCE

### Compaction

Remove old revision data:
```javascript
db.compact().then(function (info) {
  console.log('Compaction complete');
});
```

### Destroying Database

```javascript
db.destroy().then(function () {
  console.log('Database destroyed');
}).catch(function (err) {
  console.error('Error:', err);
});
```

### Checking Info

```javascript
db.info().then(function (info) {
  console.log('Doc count:', info.doc_count);
  console.log('Update seq:', info.update_seq);
  console.log('Disk size:', info.disk_size);
});
```

---

## 15. CURRENT PROJECT ARCHITECTURE

### Database Structure

```
Local Databases (IndexedDB):
   users      - User accounts and profiles
   sessions   - Active user sessions

Remote Databases (CouchDB @ localhost:5984):
   users      - Synced user data
   sessions   - Synced session data
```

### Document Types

**User Document:**
```typescript
{
  _id: "user_1234567890_uuid",
  _rev: "1-abc123",
  type: "user",
  email: "user@example.com",
  password: "hashed_password",
  fullname: "John Doe",
  verified: true,
  verificationCode: "123456",
  twoFactorEnabled: false,
  createdAt: 1234567890,
  updatedAt: 1234567890,
  profile: {
    avatar: "url",
    phone: "+1234567890"
  }
}
```

**Session Document:**
```typescript
{
  _id: "session_1234567890_uuid",
  _rev: "1-def456",
  type: "session",
  userId: "user_1234567890_uuid",
  token: "uuid-timestamp",
  expiresAt: 1234567890,
  createdAt: 1234567890
}
```

### Indexes Created

**Users Database:**
- `email` - For login lookups
- `type` - For filtering user documents

**Sessions Database:**
- `userId` - For finding user's sessions
- `expiresAt` - For cleanup of expired sessions

### Authentication Flow

1. **Sign Up:**
   - Create user with `verified: false`
   - Generate verification code
   - Store in users database
   - Code logged to console (production: send email)

2. **Verify Account:**
   - Find user by verification code
   - Update `verified: true`
   - Remove verification code

3. **Sign In:**
   - Find user by email
   - Verify password hash
   - Check if verified
   - Create session with 7-day expiry
   - Return session token

4. **Session Validation:**
   - Find session by token
   - Check expiration
   - Fetch user data
   - Return user info

5. **Sign Out:**
   - Find session by token
   - Delete session document

### Sync Strategy

- **Live bidirectional sync** with `retry: true`
- Automatic reconnection on network loss
- Changes propagate in real-time
- Conflict resolution automatic for most cases
- Manual conflict resolution for complex scenarios

---

## 16. DEBUGGING & MONITORING

### Browser DevTools

**Chrome:**
- F12 ’ Application ’ IndexedDB
- View databases, documents, indexes

**Safari:**
- Develop ’ Show Web Inspector ’ Resources ’ Databases

**Firefox:**
- F12 ’ Storage ’ IndexedDB

### Console Logging

```javascript
// Enable PouchDB debug output
PouchDB.debug.enable('*');

// Disable
PouchDB.debug.disable();
```

### Fauxton (CouchDB Admin)

Access at: http://localhost:5984/_utils/

Features:
- Browse databases
- View documents
- Run queries
- Monitor replication
- Manage users & permissions

### Common Issues

1. **CORS errors:**
   - Run `add-cors-to-couchdb`
   - Check CouchDB config

2. **409 Conflict:**
   - Stale `_rev` value
   - Refetch document and retry

3. **404 Not Found:**
   - Document doesn't exist
   - Check `_id` spelling

4. **Sync not working:**
   - Check CouchDB is running
   - Verify CORS enabled
   - Check network connectivity
   - Review sync event handlers

---

## 17. BEST PRACTICES

### Performance

1. **Use bulk operations** when possible
2. **Create indexes** before querying
3. **Use allDocs** for pagination (faster than query)
4. **Limit result sets** to necessary data
5. **Avoid $regex** and $ne (require in-memory filtering)

### Data Modeling

1. **Use meaningful _id values:**
   - Timestamps: `new Date().toJSON()`
   - Prefixed: `"user_${uuid}"`
   - Meaningful: `"config"`, `"settings"`

2. **Include type field** for multi-document databases:
   ```javascript
   { _id: 'doc1', type: 'user', ... }
   { _id: 'doc2', type: 'session', ... }
   ```

3. **Denormalize data** (no joins):
   ```javascript
   // Good: Include related data
   {
     _id: 'order_123',
     userId: 'user_456',
     userName: 'John Doe',  // Denormalized
     userEmail: 'john@example.com'  // Denormalized
   }
   ```

4. **Use local documents** for client-specific data

### Security

1. **Never store sensitive data unencrypted**
2. **Hash passwords** before storing
3. **Validate on server** (CouchDB validate_doc_update)
4. **Use HTTPS** for remote databases
5. **Implement authentication** (this project uses custom auth)

### Sync Strategy

1. **Always use live: true and retry: true** for production
2. **Handle paused events** (show offline indicator)
3. **Monitor error events** (log to monitoring service)
4. **Test offline scenarios** thoroughly
5. **Handle conflicts** gracefully

---

## 18. PRODUCTION CHECKLIST

### Before Deploy

- [ ] Enable HTTPS for CouchDB
- [ ] Configure CouchDB authentication
- [ ] Set up proper CORS rules (not *)
- [ ] Implement rate limiting
- [ ] Add monitoring/logging
- [ ] Test offline scenarios
- [ ] Test conflict resolution
- [ ] Implement backup strategy
- [ ] Review security permissions
- [ ] Optimize indexes
- [ ] Test large datasets
- [ ] Profile memory usage
- [ ] Load test replication

### CouchDB Production Setup

1. **Enable authentication:**
   - Create admin user
   - Enable require_valid_user
   - Set up per-database permissions

2. **Configure for production:**
   - Increase max_connections
   - Set appropriate timeouts
   - Configure max_document_size
   - Enable compaction schedule

3. **Monitoring:**
   - Set up health checks
   - Monitor disk usage
   - Track replication lag
   - Log errors

---

## 19. USEFUL RESOURCES

### Official Documentation
- PouchDB Docs: https://pouchdb.com/guides/
- CouchDB Docs: https://docs.couchdb.org/
- PouchDB API: https://pouchdb.com/api.html

### Tools
- Fauxton: http://localhost:5984/_utils/
- add-cors-to-couchdb: npm package
- PouchDB Server: Lightweight CouchDB alternative

### Community
- PouchDB GitHub: https://github.com/pouchdb/pouchdb
- CouchDB GitHub: https://github.com/apache/couchdb
- IRC: #pouchdb, #couchdb on Libera.Chat

---

## 20. TROUBLESHOOTING REFERENCE

### Error: "Superclass is not a constructor"
**Solution:** Use CDN version of PouchDB (already implemented)

### Error: 409 Conflict
**Cause:** Stale _rev value
**Solution:** Refetch document and retry with new _rev

### Error: 404 Not Found
**Cause:** Document doesn't exist
**Solution:** Use .catch() to handle or create default

### Sync Not Working
**Check:**
1. CouchDB running: `curl localhost:5984`
2. CORS enabled: `add-cors-to-couchdb`
3. Network connectivity
4. Database exists on both sides

### Slow Queries
**Solution:**
1. Create appropriate indexes
2. Use db.explain() to check query plan
3. Avoid $regex and $ne operators
4. Use allDocs() for simple pagination

### Memory Issues
**Solution:**
1. Use pagination with limit
2. Don't load all docs at once
3. Use changes feed instead of polling
4. Compact databases regularly

---

## END OF GUIDE

This guide covers all essential PouchDB/CouchDB operations for this project.
Refer to sections as needed when implementing features or debugging issues.

For specific API details, consult: https://pouchdb.com/api.html
